# DCA策略下阶段开发计划

## 当前状况 (2025-08-28)
- ✅ v2.0.2-Free 基础版本已稳定运行
- ✅ 自动资金调整功能正常
- ✅ GUI交易打点显示正常  
- ✅ 日志输出已优化(减少75%)

## 🚨 关键问题发现
通过订单明细分析发现：
- **回撤计算逻辑错误**: 11.86%回撤未触发加仓
- **分层保护失效**: 3层回撤保护(5%/10%/20%)完全未工作
- **固定投资**: 所有交易都是20股，没有智能调整

## 📋 下阶段开发计划

### Phase 1: 修复核心逻辑
- [ ] 修复回撤计算算法 (highest_price重置问题)
- [ ] 实现正确的分层加仓逻辑
- [ ] 验证回撤触发机制

### Phase 2: 实现分层功能架构
```python
# 统一文件，分层功能
def global_variables(self):
    self.version_tier = show_variable(1, GlobalType.INT)  # 1=免费 2=付费
    
def handle_data(self):
    if self.version_tier == 1:
        return self.free_version_logic()     # 基础定投+风险提醒
    elif self.version_tier == 2: 
        return self.advanced_version_logic() # 智能3层加仓
```

### Phase 3: 功能分层设计

#### 免费版 (Tier 1)
- 固定周期定投
- 基础回撤监控(仅显示)
- 风险提醒(>20%回撤)
- 投资统计

#### 付费版 (Tier 2) - ¥35/月
- 3层智能加仓 (5%/10%/20% → 1.5x/2x/3x)
- 动态仓位管理
- 个性化参数配置
- 月度收益报告

#### VIP版 (Tier 3) - ¥500+/年(独立App)
- 8层完整回撤系统
- 成本定投算法
- 波动率自适应
- 多标的组合投资

## 🎯 营销策略
- 单文件部署，用户选择版本等级
- 运行时提示付费功能价值
- 推文展示版本差异效果
- 免费体验 → 付费升级路径

## 📊 测试计划
- 使用相同历史数据测试不同版本
- 对比展示效果差异
- 验证加仓逻辑正确性
- 确保GUI功能完整性

## 🔄 下次对话重点
1. 修复回撤计算逻辑
2. 实现分层功能架构  
3. 测试验证策略差异
4. 准备版本发布
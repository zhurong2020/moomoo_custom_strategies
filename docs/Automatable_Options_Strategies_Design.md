# 可自动化的期权策略设计文档

**版本**: 1.0
**日期**: 2025-08-29

## 1. 文档概述

本文档旨在为多种基于Moomoo平台的、可自动化的期权策略提供清晰、统一的需求与设计规范。它将作为后续策略开发工作的核心指导蓝图。

---

## 2. 策略一：滚轮策略 (The Wheel Strategy)

### 2.1. 策略概述

*   **目标**: 对用户指定的优质股票，进行长期的、自动化的“滚轮”期权交易，以产生现金流并降低潜在持股成本。
*   **核心逻辑**: 
    1.  **卖出看跌期权 (Sell Cash-Secured Puts)**: 在无持股时，持续卖出由现金担保的虚值(OTM)看跌期权。
    2.  **等待行权/到期**: 若期权到期作废，重复此过程。若被行权，则买入股票。
    3.  **卖出看涨期权 (Sell Covered Calls)**: 持有股票后，转为持续卖出虚值(OTM)的备兑看涨期权。
    4.  **等待行权/到期**: 若期权到期作废，重复此过程。若被行权，股票被卖出，回到现金状态，重新开始整个循环。
*   **市场观点**: 对标的长期温和看涨。

### 2.2. 自动化工作流

策略主要在 `SELLING_PUTS` 和 `SELLING_CALLS` 两个状态间切换。

*   **`SELLING_PUTS` 状态**: 
    1.  **进入条件**: `position_holding_qty()` == 0。
    2.  **选择合约**: 使用 `option_screener` 和 `option_delta` 寻找30-45天到期、Delta最接近 **-0.30** 的Put合约。
    3.  **下单**: 检查 `available_fund`，通过 `place_limit` 卖出该合约。
*   **`SELLING_CALLS` 状态**: 
    1.  **进入条件**: `position_holding_qty()` > 0。
    2.  **选择合约**: 使用 `option_screener` 和 `option_delta` 寻找30-45天到期、Delta最接近 **0.30** 的Call合约。
    3.  **下单**: 根据持股数，通过 `place_limit` 卖出相应手数的Call合约。

### 2.3. 关键参数配置

*   `target_underlying`: (string) 目标股票代码。
*   `contracts_to_sell`: (int) 每次卖出的合约数量。
*   `days_to_expiration_min`/`max`: (int) 到期日范围 (如 30-45)。
*   `put_target_delta`/`call_target_delta`: (float) 目标Delta值。
*   `profit_target_pct`: (float) 提前平仓的盈利目标百分比。

### 2.4. API依赖清单

`position_holding_qty`, `available_fund`, `option_screener`, `option_delta`, `option_strike_price`, `mid_price`, `place_limit`, `current_price` (期权价格)。

---

## 3. 策略二：铁鹰组合 (Iron Condor)

### 3.1. 策略概述

*   **目标**: 在股价区间震荡时，通过卖出期权组合来赚取权利金，并严格控制风险。
*   **核心逻辑**: 本质是同时卖出一个看涨期权价差（Bear Call Spread）和一个看跌期权价差（Bull Put Spread）。它由四条“腿”组成：
    1.  卖一个虚值Put (Sell OTM Put)
    2.  买一个更虚值的Put (Buy further OTM Put)
    3.  卖一个虚值Call (Sell OTM Call)
    4.  买一个更虚值的Call (Buy further OTM Call)
*   **市场观点**: 股价将在一个可预见的范围内横盘整理，或隐含波动率(IV)将下降。
*   **核心优势**: **风险和收益均在建仓时就已确定**。最大亏损被严格限定，非常适合自动化交易。

### 3.2. 自动化工作流

*   **入场 (Entry)**:
    1.  **选择到期日**: 使用 `option_screener` 筛选30-45天到期的期权。
    2.  **确定卖方合约 (Short Legs)**: 
        *   使用 `option_delta` 找到Delta最接近 **-0.15** 的Put合约，作为 `Sell Put` 的目标。
        *   使用 `option_delta` 找到Delta最接近 **0.15** 的Call合约，作为 `Sell Call` 的目标。
    3.  **确定买方合约 (Long Legs)**: 
        *   在 `Sell Put` 的行权价基础上，减去一个固定的“宽度”(`condor_width`)，确定 `Buy Put` 的行权价。
        *   在 `Sell Call` 的行权价基础上，加上一个固定的“宽度”(`condor_width`)，确定 `Buy Call` 的行权价。
    4.  **下单**: 分别通过 `place_limit` 提交这四个订单，构建完整的Iron Condor仓位。
*   **管理 (Management)**:
    *   监控整个组合的价值。当盈利达到最大理论盈利的50% (`profit_target_pct`) 时，提前平仓所有四条腿，锁定利润。
    *   当股价接近某一边卖出的行权价时，可考虑提前移仓或平仓以规避风险。

### 3.3. 关键参数配置

*   `target_underlying`: (string) 目标股票代码。
*   `days_to_expiration_min`/`max`: (int) 到期日范围。
*   `short_leg_delta`: (float) 卖方合约的目标Delta值 (例如 0.15)。
*   `condor_width`: (float) 两条腿之间的行权价宽度 (例如 $5 或 $10)。
*   `profit_target_pct`: (float) 提前平仓的盈利目标百分比。
*   `contracts_per_side`: (int) 每边交易的合约数量。

### 3.4. API依赖清单

与滚轮策略基本相同，额外需要更频繁地查询四条腿的 `current_price` 来计算组合的整体价值。

---

## 4. 宏观事件驱动策略：利率周期

以下策略基于对宏观经济环境（特别是美联储利率政策）的长期判断，属于事件驱动型策略。

### 4.1. 策略三：降息通道滚轮 (TLT Wheel)

*   **适用场景**: 明确处于**降息通道**，市场预期利率将持续走低。
*   **目标标的**: `TLT` (20+年美国国债ETF) 或其他长期债券ETF。
*   **策略概述**: 此场景下 `TLT` 价格长期看涨，完全适用**策略一（滚轮策略）**。通过对 `TLT` 持续执行卖出看跌期权、接盘后卖出备兑看涨期权的操作，在享受趋势红利的同时，不断创造现金流。
*   **市场观点**: 对 `TLT` 温和看涨。
*   **自动化工作流**: 与**策略一（滚轮策略）**完全相同。
*   **关键参数建议**:
    *   `target_underlying`: 'TLT'
    *   `put_target_delta`: -0.20 (相对保守)
    *   `call_target_delta`: 0.20 (相对保守)

### 4.2. 策略四：升息通道看涨期权价差 (TLT Bear Call Spread)

*   **适用场景**: 明确处于**升息通道**，市场预期利率将持续走高。
*   **目标标的**: `TLT` (20+年美国国债ETF)。
*   **策略概述**: 此场景下 `TLT` 价格长期看跌。为规避无限风险的做空操作，采用风险可控的看涨期权价差策略。该策略通过卖出一个虚值Call，同时买入一个更虚值的Call来构建，以赚取权利金。
*   **核心优势**: **风险和收益在建仓时完全锁定**，无需持有股票头寸，非常适合在下跌趋势中进行自动化。
*   **市场观点**: 对 `TLT` 看跌或横盘整理。
*   **自动化工作流**:
    1.  **选择合约**: 筛选30-45天到期的期权，使用 `option_delta` 找到Delta最接近 **0.20** 的Call合约作为卖方腿 (Short Leg)。
    2.  **构建价差**: 在卖方腿的行权价基础上，加上一个固定的“宽度”(`spread_width`)，买入对应行权价的Call合约作为保护腿 (Long Leg)。
    3.  **下单**: 同时提交两个订单，构建Bear Call Spread。
    4.  **管理**: 监控价差组合的价值，在盈利达到最大利润的50%时提前平仓，或持有至到期。
*   **关键参数配置**:
    *   `target_underlying`: 'TLT'
    *   `short_leg_delta`: 0.20
    *   `spread_width`: $2 (根据风险偏好调整)
    *   `profit_target_pct`: 0.50

### 4.3. 策略五：穷人的备兑看涨期权 (Poor Man's Covered Call - PMCC)

*   **适用场景**: 长期看好某只股票，但希望以更少的资金实现类似“持股收租”的效果，追求高资金回报率。
*   **策略概述**: 使用一张长期深度实值看涨期权（LEAPS Call）来代替持有100股股票，然后像常规的备兑看涨期权一样，循环卖出短期的虚值看涨期权来创造现金流。
*   **核心优势**: **极高的资金效率**。通常只需常规策略20-30%的资金，即可获得相似的回报效果。
*   **市场观点**: 对标的长期非常看好。
*   **自动化工作流**:
    *   **A. LEAPS腿管理 (长线持仓)**
        1.  **建仓**: 筛选 `DTE > 365` 且 `Delta > 0.80` 的Call作为LEAPS腿，买入并长期持有。
        2.  **展期**: 当LEAPS腿的剩余 `DTE < 90` 时，卖出当前LEAPS，重新买入一张符合建仓条件的、更远期的新LEAPS。
    *   **B. 短期Call腿管理 (循环收租)**
        1.  **开仓**: 在持有LEAPS腿的基础上，筛选 `DTE` 在30-45天、`Delta` 在0.20-0.30之间的短期Call进行卖出。
        2.  **管理**: 
            *   **盈利平仓**: 当短期Call的价值下跌超过50%时，买入平仓，并立即开仓下一轮。
            *   **到期处理**: 如果短期Call到期作废，直接开仓下一轮。
            *   **展期管理**: 如果股价上涨导致短期Call的Delta超过0.40，则执行“向上向远”展期操作，避免被行权。
*   **关键参数配置**:
    *   `leaps_min_dte`: 365 (LEAPS最小到期日)
    *   `leaps_min_delta`: 0.80 (LEAPS最小Delta)
    *   `leaps_roll_dte_trigger`: 90 (触发LEAPS展期的剩余天数)
    *   `short_call_dte_min`/`max`: 30 / 45
    *   `short_call_target_delta`: 0.20
    *   `short_call_profit_target_pct`: 0.50
    *   `short_call_roll_delta_trigger`: 0.40

### 4.4. 策略六：牛市看跌期权价差 (Bull Put Spread)

*   **给新手的说明**: 这是一个非常适合新手的、高胜率的“收租”策略。您可以把它想象成在股价下方设置一条“防线”。只要到期时，股价没有跌破这条防线，您就能100%赚到我们一开始收到的权利金。这个策略的妙处在于，股价不需要上涨，它只需要横盘甚至小幅下跌，您都能盈利。

*   **核心逻辑**: 卖出一个虚值看跌期权（获得权利金），同时买入一个更虚值的看跌期权（付出成本作为保险），从而构建一个风险完全锁定的组合。

*   **举例说明**:
    *   **背景**: 股票XYZ当前价格为$100。
    *   **操作**: 
        1.  **卖出**一张行权价为 **$95** 的Put，收到权利金 **$150**。
        2.  **买入**一张行权价为 **$90** 的Put，付出成本 **$50** 作为保险。
    *   **初始状态**:
        *   **净收入**: 您立即获得 `$150 - $50 = $100` 的现金，这是您的**最大利润**。
        *   **最大风险**: 两条防线的宽度是 `$95 - $90 = $5`，即$500。您的最大亏损 = `$500 - $100 (已收收入) = $400`。这个亏损只有在股价跌破$90时才会发生。
    *   **到期结果**:
        *   **情景A (盈利)**: 股价收在 **$95** 或以上。两张期权都作废，您净赚 **$100**。
        *   **情景B (亏损)**: 股价收在 **$88** (低于$90)。您承受最大亏损 **$400**。
        *   **盈亏平衡点**: `$95 (卖出Put的行权价) - $1 (收到的净权利金) = $94`。只要股价高于$94，您就不会亏钱。

*   **自动化工作流**: 循环执行以下操作：寻找满足`delta`和`DTE`条件的合约 → 构建价差并下单 → 监控仓位，在盈利达到50%时平仓或持有至到期。

*   **关键参数配置**:
    *   `short_put_delta`: -0.30 (决定了“防线”的远近)
    *   `spread_width`: 5 (价差宽度，决定了风险和收益比)
    *   `profit_target_pct`: 0.50

### 4.5. 策略七：玉蜥蜴 (Jade Lizard)

*   **给新手的说明**: 这是一个更精巧的“收租”策略。您可以把它看作是“卖出一个看跌期权，同时在上方买了一份免费的、能消除所有上涨风险的保险”。它在Bull Put Spread的基础上，解决了“万一股票大涨怎么办”的烦恼。

*   **核心逻辑**: 卖出一个虚值的看跌期权（收租），同时在股价上方卖出一个看涨期权价差（Bear Call Spread），用这份收入来对冲风险。

*   **举例说明**:
    *   **背景**: 股票XYZ当前价格为$100。
    *   **操作**: 
        1.  **卖出**一张行权价为 **$95** 的Put，收到权利金 **$150**。
        2.  **同时**，在上方卖出一个Bear Call Spread：卖出$105的Call，买入$107的Call，净收入权利金 **$60**。
    *   **初始状态**:
        *   **总净收入**: 您立即获得 `$150 + $60 = $210` 的现金。
        *   **上方价差宽度**: `$107 - $105 = $2`，即$200。
    *   **策略精髓 - 上方无风险**:
        *   您收到的总权利金是 **$210**，而您上方价差可能产生的最大亏损仅为 **$200**。这意味着，就算股价涨到天上去，您需要赔付的$200，也比您一开始收到的$210要少。您最差也是赚$10。**上涨风险被完全消除了**。
    *   **到期结果**:
        *   **情景A (最大利润)**: 股价收在 **$95 到 $105** 之间。所有期权都作废，您净赚 **$210**。
        *   **情景B (下跌亏损)**: 股价跌破下方防线。您的盈亏平衡点 = `$95 - $2.10 (总收入) = $92.90`。

*   **自动化工作流**: 相比Bull Put Spread更复杂，需要扫描两侧，寻找能满足“总收入 > 上方价差宽度”条件的合约组合，然后建仓并管理。

*   **关键参数配置**:
    *   `short_put_delta`: -0.30
    *   `short_call_spread_delta`: 0.30
    *   `call_spread_width`: 2

---

## 5. 风险与免责声明

*   **风险提示**: 所有期权策略均涉及风险。Iron Condor和Bear Call Spread虽然风险可控，但在股价大幅突破预期范围时，依然会发生已计算好的最大亏损。滚轮策略在标的持续下跌时可能导致较大浮亏。
*   **免责声明**: 本自动化策略仅为交易执行工具，不构成任何投资建议。所有交易决策的风险由用户自行承担。
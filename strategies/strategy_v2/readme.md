# MARA网格交易策略说明文档

## 1. 核心功能概述

这是一个基于网格交易法则的自动化交易策略，专门针对MARA Holdings (US.MARA)股票开发，主要特点包括：
- 基于2%网格间距动态创建交易网格
- 单网格交易量固定为20股，由最大总持仓(500股)限制控制
- 在美股常规交易时间（9:30-16:00 ET）运行
- 采用单个网格2%止盈策略
- 支持动态网格重置和持仓管理

## 2. 关键参数设置

### 策略参数
- `max_position`: 最大持仓限额，默认500股
- `grid_size`: 每次交易数量，默认20股
- `grid_height`: 网格间距，默认2%
- `profit_ratio`: 止盈比例，默认2%
- `min_reset_interval`: 最小网格重置间隔，默认6小时
- `order_timeout`: 订单超时时间，默认300秒

### 参数约束关系
1. 单次交易数量与最大持仓限额关系：
   ```
   grid_size * (预期最大建仓次数) ≤ max_position
   例如：20股 * 25次 ≤ 500股
   ```

2. 止盈比例与网格间距关系：
   ```
   profit_ratio ≤ grid_height
   例如：2% = 2%，确保在达到网格边界时可以止盈
   ```

## 3. 交易逻辑

### 3.1 网格管理
- 以当前价格为基准价格，设置基准网格
- 向上设置1个网格（+2%）
- 向下设置1个网格（-2%）
- 价格突破网格边界时触发重置
- 执行网格重置需满足最小间隔时间限制

### 3.2 建仓逻辑
1. 建仓条件：
   - 当前持仓未达到最大限额
   - 无进行中的买入订单
   - 价格位于有效交易区间
   
2. 执行建仓：
   - 使用限价单进行买入
   - 每次固定购买20股
   - 设置订单超时机制
   - 记录买入价格和数量

### 3.3 平仓逻辑
- 按单个网格计算盈利比例
- 当某网格盈利达到2%时触发平仓
- 多个网格同时满足条件时批量平仓
- 立即尝试在平仓价位重新建仓

## 4. 风险控制机制

### 4.1 订单管理
- 使用限价单控制成交价格
- 订单超时自动撤销（300秒）
- 详细记录订单状态变化
- 实现订单查询和监控

### 4.2 持仓控制
- 严格执行最大持仓限制
- 实时跟踪各网格持仓
- 计算并更新持仓均价
- 定期输出持仓汇总信息

### 4.3 交易时间控制
- 仅在美股常规交易时间交易
- 每个交易日重置执行状态
- 网格重置时间间隔限制
- 防止频繁交易的机制

## 5. 回测表现

策略在2024/10/24-2024/11/08期间的回测结果：

### 交易统计
- 总交易次数：14笔（9次买入，5次卖出）
- 最大持仓：120股
- 典型持仓时间：1-2个交易日
- 最大单笔盈利：11.4%（买入价15.80，卖出价17.60）

### 代表性交易
```
10/24：买入 20股 @ $18.40
10/29：卖出 60股 @ $19.38（首轮获利）
11/06：卖出 60股 @ $17.60（第二轮获利）
11/07：卖出 40股 @ $18.90（第三轮获利）
```

## 6. 使用建议

### 6.1 适用场景
- 适合波动区间明显的股票
- 建议用于日内波动2%以上的标的
- 需要保证充足的流动性

### 6.2 参数调优建议
- 根据股票波动特性调整网格间距
- 可根据流动性调整单次交易量
- 交易成本高时可提高止盈比例

### 6.3 注意事项
- 策略不包含止损机制
- 需要持续监控市场环境
- 建议先进行模拟交易测试

## 7. 待优化方向

1. 引入止损机制
2. 开发自适应网格间距
3. 优化网格重置条件
4. 加入技术指标辅助判断
5. 完善资金管理策略
6. 增加回撤控制机制